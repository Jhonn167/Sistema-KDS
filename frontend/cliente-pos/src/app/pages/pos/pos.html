<!-- src/app/pages/pos/pos.component.html -->
<div class="app-container">
  <!-- ===== HEADER ===== -->
  <header class="app-header">
    <div class="header-left">
      <div class="app-icon">POS</div>
      <h1>System</h1>
      <nav class="main-nav">
        <a href="#" class="nav-link active">Punto de Venta</a>
        <a href="#" class="nav-link">Productos</a>
        <a href="#" class="nav-link">Reportes</a>
        <a href="#" class="nav-link">Cocina</a>
        <a href="#" class="nav-link">Usuarios</a>
      </nav>
    </div>
    <div class="header-right">
      <button class="my-account-btn">
        <i class="fas fa-user"></i> Mi Cuenta
      </button>
      <img src="https://i.pravatar.cc/40" alt="User Avatar" class="user-avatar">
    </div>
  </header>

  <!-- ===== MAIN ===== -->
  <main class="app-main">
    <!-- === SECCIÓN DE PRODUCTOS === -->
    <div class="products-section">
      <!-- Barra de búsqueda -->
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input
          type="text"
          placeholder="Buscar productos..."
          [(ngModel)]="searchTerm"
          (keyup)="onSearchKeyUp()"
        >
      </div>

      <!-- Filtros de categoría -->
      <div class="category-filters">
        <button
          class="filter-btn"
          [class.active]="selectedCategoryId === null"
          (click)="selectCategory(null)"
        >
          Todos
        </button>
        <button
          *ngFor="let category of categories"
          class="filter-btn"
          [class.active]="selectedCategoryId === category.id_categoria"
          (click)="selectCategory(category.id_categoria)"
        >
          {{ category.nombre }}
        </button>
      </div>

      <!-- Grid de productos -->
      <div class="product-grid">
        <div
          *ngFor="let product of products"
          class="product-card"
          (click)="handleAddItem(product)"
          [class.disabled]="product.stock === 0"
        >
          <img
            [src]="product.imagen_url || 'assets/placeholder.png'"
            [alt]="product.nombre"
          >
          <h3>{{ product.nombre }}</h3>
          <p class="price">{{ product.precio | currency:'MXN' }}</p>
          <button class="add-to-order-btn" [disabled]="product.stock === 0">
            {{ product.stock > 0 ? 'Añadir a la Orden' : 'Agotado' }}
          </button>
        </div>
      </div>
    </div>

    <!-- === PANEL DE ORDEN === -->
    <aside class="order-summary">
      <h2>Orden Actual</h2>

      <!-- Lista de productos -->
      <div class="order-items" *ngIf="(orderItems$ | async)?.length; else emptyTicket">
        <div *ngFor="let item of (orderItems$ | async)" class="order-item">
          <div class="item-info">
            <span class="item-name">{{ item.nombre }}</span>
            <ul *ngIf="item.selectedOptions.length > 0" class="item-options">
              <li *ngFor="let option of item.selectedOptions">+ {{ option.nombre }}</li>
            </ul>
          </div>

          <div class="item-quantity">
            <button (click)="orderService.updateItemQuantity(item.cartItemId, -1)">-</button>
            <span>{{ item.cantidad }}</span>
            <button (click)="orderService.updateItemQuantity(item.cartItemId, 1)">+</button>
          </div>

          <span class="item-price">
            {{ (item.precioFinal * item.cantidad) | currency:'MXN' }}
          </span>

          <button
            class="remove-item-btn"
            (click)="orderService.removeItem(item.cartItemId)"
          >
            &times;
          </button>
        </div>
      </div>

      <!-- Mensaje si no hay productos -->
      <ng-template #emptyTicket>
        <div class="no-items-message">
          <p>No hay productos en la orden.</p>
        </div>
      </ng-template>

      <!-- Totales -->
      <div class="order-total">
        <div class="total-line">
          <span>Subtotal:</span>
          <span>{{ (orderTotal$ | async) | currency:'MXN' }}</span>
        </div>
        <div class="total-line">
          <span>Impuestos (IVA 16%):</span>
          <span>{{ ((orderTotal$ | async) ?? 0) * 0.16 | currency:'MXN' }}</span>
        </div>
        <div class="total-line grand-total">
          <span>Total:</span>
          <span>{{ ((orderTotal$ | async) ?? 0) * 1.16 | currency:'MXN' }}</span>
        </div>
      </div>

      <!-- Botones de acción -->
      <div class="order-actions">
        <button class="clear-btn" (click)="orderService.clearOrder()">Limpiar Orden</button>
        <button
          class="process-btn"
          [disabled]="(orderItems$ | async)?.length === 0"
          (click)="onCheckout()"
        >
          Procesar Pago
        </button>
      </div>
    </aside>
  </main>

  <!-- === MODAL DE OPCIONES === -->
  <app-modifier-modal
    *ngIf="isModalOpen"
    [product]="selectedProduct"
    (confirm)="onConfirmProduct($event)"
    (close)="closeModal()"
  >
  </app-modifier-modal>
</div>